<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifica Quarta: AI e Algoritmi - Prof. Adinolfi</title>
    <style>
        :root {
            --primary-color: #002d4d;
            --secondary-color: #28a745;
            --bg-color: #f8f9fa;
        }
        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; overflow: hidden; background-color: var(--bg-color); }
        
        /* Layout Split-Screen */
        #left-panel { width: 45%; height: 100%; display: flex; flex-direction: column; background: #e0e0e0; border-right: 3px solid var(--primary-color); }
        #right-panel { width: 55%; height: 100%; overflow-y: auto; padding: 30px; box-sizing: border-box; display: flex; flex-direction: column; }
        
        .viewer-header { background: #fff; padding: 10px; border-bottom: 1px solid #ccc; display: flex; gap: 10px; }
        #pdf-viewer { flex-grow: 1; width: 100%; border: none; }

        .header-box { background: var(--primary-color); color: white; padding: 15px 25px; border-radius: 5px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        
        .question-card { background: white; padding: 20px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd; }
        .question-card h4 { margin-top: 0; color: var(--primary-color); }
        
        textarea { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-family: inherit; resize: vertical; }

        .btn-send { background-color: var(--secondary-color); color: white; border: none; padding: 18px; border-radius: 5px; cursor: pointer; width: 100%; font-size: 1.1em; font-weight: bold; text-transform: uppercase; margin-top: 20px; }
        
        label { display: block; padding: 10px; margin: 5px 0; border: 1px solid #eee; border-radius: 6px; cursor: pointer; }
        label:hover { background: #f0f4f8; }
    </style>
</head>
<body>

    <div id="left-panel">
        <div class="viewer-header">
            <select id="docSelect" onchange="caricaDocumento(this.value)" style="padding: 5px; flex-grow: 1;">
                <option value="">-- Seleziona Materiale di Supporto --</option>
                <option value="tracce/dispensa_ai.pdf">Dispensa AI (PDF)</option>
                <option value="tracce/schema_algoritmi.png">Schema Algoritmi (Immagine)</option>
            </select>
        </div>
        <iframe id="pdf-viewer" src="about:blank"></iframe>
    </div>

    <div id="right-panel">
        <div class="header-box">
            <div>Studente: <span id="student-name">...</span></div>
            <div id="timer-display" style="font-weight: bold;">45:00</div>
        </div>

        <form id="quizForm">
            <div class="question-card">
                <h4>1. Qual è l'ordine gerarchico della piramide DIKW?</h4>
                <label><input type="radio" name="q1" value="Dati-Conoscenza-Informazione"> Dati, Conoscenza, Informazione, Saggezza</label>
                <label><input type="radio" name="q1" value="Dati-Informazione-Conoscenza"> Dati, Informazione, Conoscenza, Saggezza</label>
            </div>

            <div class="question-card">
                <h4>2. Descrivi brevemente come il Machine Learning modifica il proprio algoritmo:</h4>
                <textarea name="q2" rows="4" placeholder="Scrivi qui la tua risposta..."></textarea>
            </div>

            <button type="button" class="btn-send" onclick="inviaConsegnaAI()">
                <i class="fas fa-paper-plane"></i> INVIA VERIFICA AL DRIVE
            </button>
        </form>
    </div>

    <iframe name="gasTarget" style="display:none;"></iframe>

    <script>
        const startTime = new Date();
        const nomeStudente = sessionStorage.getItem("userName") || "Studente_Ospite";
        document.getElementById("student-name").innerText = nomeStudente;

        function caricaDocumento(url) {
            if (url) document.getElementById('pdf-viewer').src = url;
        }

        function inviaConsegnaAI() {
            const formElement = document.getElementById("quizForm");
            const formData = new FormData(formElement);
            let reportVerifica = `STUDENTE: ${nomeStudente}\nDATA: ${new Date().toLocaleString()}\n\nRISPOSTE:\n`;
            
            // Ciclo per raccogliere tutte le risposte dal form
            formData.forEach((value, key) => {
                reportVerifica += `Domanda ${key}: ${value}\n`;
            });

            // Endpoint del tuo Google Apps Script (lo stesso di classe.html)
            const GAS_URL = "https://script.google.com/macros/s/AKfycbyXYR1fJ2yYKKbgd_cIdNUTbIG5fZH3piPQ75Bw2TC-YkMcUaM7bOvzUQWNNGGmjcdg/exec";
            
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = GAS_URL;
            form.target = 'gasTarget';

            const addField = (n, v) => {
                const i = document.createElement('input');
                i.type = 'hidden'; i.name = n; i.value = v;
                form.appendChild(i);
            };

            addField('nomeStudente', nomeStudente);
            addField('classe', 'Quarta');
            addField('dataOra', new Date().toLocaleString());
            addField('rtfContent', reportVerifica); // Inviato come testo semplice o formattato
            addField('pyContent', "RISPOSTE QUIZ"); // Placeholder per differenziarlo dal codice Python

            document.body.appendChild(form);
            form.submit();

            alert("✅ Verifica inviata con successo!");
            window.location.href = "index.html";
        }

        // Timer di 45 minuti
        let secondsLeft = 45 * 60;
        setInterval(() => {
            if (secondsLeft <= 0) return;
            secondsLeft--;
            let m = Math.floor(secondsLeft / 60);
            let s = secondsLeft % 60;
            document.getElementById("timer-display").innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
        }, 1000);
    </script>
</body>
</html>
